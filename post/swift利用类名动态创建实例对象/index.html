<!DOCTYPE html>
<html lang="en-us">
    <head>
         
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Swift利用类名动态创建实例对象</title>
        
        <style>

    html body {
        font-family: 'Raleway', sans-serif;
        background-color: white;
    }

    :root {
        --accent: green;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://jiadingyi.github.io/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">


 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 


    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/Objective-C.min.js"></script> 

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.84.3" />
        

        
    </head>

    
    
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    

    <body>
         
        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Swift利用类名动态创建实例对象</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/">Home</a></li>
                            
                                <li><a href="/post/">Posts</a></li>
                            
                                <li><a href="/project/">Projects</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="mailto:wzy2010416033@163.com"><i class="fa fa-envelope-o"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://github.com/JiaDingYi"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/_ThrowException"><i class="fa fa-twitter"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://www.linkedin.com/in/%e6%b3%bd%e6%b0%b8-%e7%8e%8b-3b6749108/"><i class="fa fa-linkedin"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://stackexchange.com/users/7687761/dingyi-jia"><i class="fa fa-stack-overflow"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main>

    <div class="item">

    
    
    

    
    

    <h4><a href="/post/swift%E5%88%A9%E7%94%A8%E7%B1%BB%E5%90%8D%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B%E5%AF%B9%E8%B1%A1/">Swift利用类名动态创建实例对象</a></h4>
    <h5>July 2, 2021</h5>
    
    <a href="https://jiadingyi.github.iotags/swift"><kbd class="item-tag">swift</kbd></a>
    

</div>


    <br> <div class="text-justify"><h1 id="swift-利用类名动态创建实例对象">Swift 利用类名动态创建实例对象</h1>
<h2 id="oc-通过字符串创建实例对象">OC 通过字符串创建实例对象</h2>
<p>在OC中我们可以通过下列方法轻松创建实例对象</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objective-c" data-lang="objective-c">NSString <span style="color:#f92672">*</span>className <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;UIView&#34;</span>;
<span style="color:#66d9ef">Class</span> <span style="color:#66d9ef">class</span> <span style="color:#f92672">=</span> NSClassFromString(className);
UIView <span style="color:#f92672">*</span>view <span style="color:#f92672">=</span> [[<span style="color:#66d9ef">class</span> alloc] init];
</code></pre></div><h2 id="swift-中通过字符串创建实例对象">Swift 中通过字符串创建实例对象</h2>
<ol>
<li>
<p>获取命名空间</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">currentNameSpace</span>() -&gt; String? {
     <span style="color:#66d9ef">guard</span> <span style="color:#66d9ef">let</span> spaceName = Bundle.main.infoDictionary![<span style="color:#e6db74">&#34;CFBundleExecutable&#34;</span>] <span style="color:#66d9ef">as</span>? String <span style="color:#66d9ef">else</span> {
         print(<span style="color:#e6db74">&#34;获取命名空间失败&#34;</span>)
         <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
     }
     <span style="color:#66d9ef">return</span> spaceName
 }
</code></pre></div></li>
<li>
<p>获取类名并创建实例对象</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">registerAdapters</span>&lt;T&gt;() -&gt; [T]? <span style="color:#66d9ef">where</span> T: Adapter {
     <span style="color:#66d9ef">guard</span> <span style="color:#66d9ef">let</span> spaceName = currentNameSpace() <span style="color:#66d9ef">else</span> {
         <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
     }
     <span style="color:#66d9ef">var</span> adapters: [T] = []
     <span style="color:#66d9ef">for</span> adapter <span style="color:#66d9ef">in</span> adaptersName {
         <span style="color:#66d9ef">let</span> fullName = spaceName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span> adapter
         <span style="color:#66d9ef">guard</span> <span style="color:#66d9ef">let</span> metaClass = NSClassFromString(fullName) <span style="color:#66d9ef">as</span>? T.<span style="color:#66d9ef">Type</span> <span style="color:#66d9ef">else</span> {
             print(<span style="color:#e6db74">&#34;获取元类型失败&#34;</span>)
             <span style="color:#66d9ef">continue</span>
         }

         adapters.append(metaClass.<span style="color:#66d9ef">init</span>(name: adapter))
     }
     <span style="color:#66d9ef">return</span> adapters
 }
</code></pre></div><p>通过 NSClassFromString 获取到的元类型需要转成确定的类型，这里使用了范型 T: Adapter。
Adapter 为声明的协议。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">protocol</span> <span style="color:#a6e22e">Adapter</span> {
 <span style="color:#66d9ef">init</span>(name: String)
 <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">showing</span>()
}
</code></pre></div></li>
<li>
<p>失败的尝试</p>
<ul>
<li>
<p>首先声明 3 个遵循 Adapter 协议的类</p>
<ul>
<li>注意：因为Adapter协议中声明了 init(name: String) 方法，所以实现init方法时，要加 required 关键字，代表其子类也要实现此 init 方法。</li>
<li><a href="https://swifter.tips/init-keywords/">DESIGNATED，CONVENIENCE 和 REQUIRED</a>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FirstAdapter</span>: Adapter {
    <span style="color:#66d9ef">var</span> name: String!
    <span style="color:#66d9ef">required</span> <span style="color:#66d9ef">init</span>(name: String) {
        <span style="color:#66d9ef">super</span>.<span style="color:#66d9ef">init</span>(name: name)
        <span style="color:#66d9ef">self</span>.name = name
        print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is loading&#34;</span>)
    }

    <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">showing</span>() {
        print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is showing&#34;</span>)
    }
}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecondAdapter</span>: Adapter {
    <span style="color:#66d9ef">var</span> name: String!
    <span style="color:#66d9ef">required</span> <span style="color:#66d9ef">init</span>(name: String) {
        <span style="color:#66d9ef">super</span>.<span style="color:#66d9ef">init</span>(name: name)
        <span style="color:#66d9ef">self</span>.name = name
        print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is loading&#34;</span>)
    }

    <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">showing</span>() {
        print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is showing&#34;</span>)
    }
}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ThirdAdapter</span>: Adapter {
    <span style="color:#66d9ef">var</span> name: String!
    <span style="color:#66d9ef">required</span> <span style="color:#66d9ef">init</span>(name: String) {
        <span style="color:#66d9ef">super</span>.<span style="color:#66d9ef">init</span>(name: name)
        <span style="color:#66d9ef">self</span>.name = name
        print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is loading&#34;</span>)
    }

    <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">showing</span>() {
        print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is showing&#34;</span>)
    }
}
</code></pre></div></li>
</ul>
</li>
<li>
<p>demo 报错信息<br>
<img src="Swift%E5%88%A9%E7%94%A8%E7%B1%BB%E5%90%8D%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B%E5%AF%B9%E8%B1%A1_1.png" alt="avatar">
报错信息 <code>Generic parameter 'T' could not be inferred</code>
不能推导出范型的具体类型。</p>
</li>
</ul>
</li>
<li>
<p>做的改进</p>
<ul>
<li>声明一个 FatherAdapter 类，遵循 Adapter 协议
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FatherAdapter</span>: Adapter {
<span style="color:#66d9ef">required</span> <span style="color:#66d9ef">init</span>(name: String) {}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">showing</span>() {}
}
</code></pre></div></li>
<li>FirstAdapter, SecondAdapter, ThirdAdapter 都继承 FatherAdapter
<ul>
<li>添加 super.init(name: name)</li>
<li>showing() 添加 override</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FirstAdapter</span>: FatherAdapter {
     <span style="color:#66d9ef">var</span> name: String!
     <span style="color:#66d9ef">required</span> <span style="color:#66d9ef">init</span>(name: String) {
         <span style="color:#66d9ef">super</span>.<span style="color:#66d9ef">init</span>(name: name)
         <span style="color:#66d9ef">self</span>.name = name
         print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is loading&#34;</span>)
     }

     <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">showing</span>() {
         print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is showing&#34;</span>)
     }
 }

 <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecondAdapter</span>: FatherAdapter {
     <span style="color:#66d9ef">var</span> name: String!
     <span style="color:#66d9ef">required</span> <span style="color:#66d9ef">init</span>(name: String) {
         <span style="color:#66d9ef">super</span>.<span style="color:#66d9ef">init</span>(name: name)
         <span style="color:#66d9ef">self</span>.name = name
         print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is loading&#34;</span>)
     }

     <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">showing</span>() {
         print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is showing&#34;</span>)
     }
 }

 <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ThirdAdapter</span>: FatherAdapter {
     <span style="color:#66d9ef">var</span> name: String!
     <span style="color:#66d9ef">required</span> <span style="color:#66d9ef">init</span>(name: String) {
         <span style="color:#66d9ef">super</span>.<span style="color:#66d9ef">init</span>(name: name)
         <span style="color:#66d9ef">self</span>.name = name
         print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is loading&#34;</span>)
     }

     <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">showing</span>() {
         print(name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is showing&#34;</span>)
     }
 }
</code></pre></div><ul>
<li>改进 demo
<ul>
<li>let adapters: [FatherAdapter] = register.registerAdapters() 范型直接使用 FaterAdapter</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ViewController</span>: UIViewController {
 <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">viewDidLoad</span>() {
     <span style="color:#66d9ef">super</span>.viewDidLoad()
     view.backgroundColor = UIColor.blue

     <span style="color:#66d9ef">let</span> register = Register(adaptersName: [<span style="color:#e6db74">&#34;FirstAdapter&#34;</span>, <span style="color:#e6db74">&#34;SecondAdapter&#34;</span>, <span style="color:#e6db74">&#34;ThirdAdapter&#34;</span>])
     <span style="color:#66d9ef">guard</span> <span style="color:#66d9ef">let</span> adapters: [FatherAdapter] = register.registerAdapters() <span style="color:#66d9ef">else</span> {
         <span style="color:#66d9ef">return</span>
     }
     <span style="color:#66d9ef">guard</span> adapters.count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> {
         <span style="color:#66d9ef">return</span>
     }
     <span style="color:#66d9ef">for</span> adapter <span style="color:#66d9ef">in</span> adapters {
         adapter.showing()
     }
 }
}
</code></pre></div><ul>
<li>运行结果<br>
<img src="Swift%E5%88%A9%E7%94%A8%E7%B1%BB%E5%90%8D%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B%E5%AF%B9%E8%B1%A1_2.png" alt="result"></li>
</ul>
</li>
</ol>
</div>

    
    

    

        <h4 class="page-header">Related</h4>

         <div class="item">

    
    
    

    
    

    <h4><a href="/post/swift%E5%88%A9%E7%94%A8%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E5%89%8D%E7%BC%80%E5%8A%9F%E8%83%BD/">Swift利用协议实现前缀功能</a></h4>
    <h5>July 1, 2021</h5>
    
    <a href="https://jiadingyi.github.iotags/swift"><kbd class="item-tag">swift</kbd></a>
    

</div>
  <div class="item">

    
    
    

    
    

    <h4><a href="/post/swift%E4%B8%AD%E7%9A%84%E5%B1%9E%E6%80%A7/">Swift中的属性</a></h4>
    <h5>June 17, 2021</h5>
    
    <a href="https://jiadingyi.github.iotags/swift"><kbd class="item-tag">swift</kbd></a>
    

</div>
 

    

    

        <h4 class="page-header">Comments</h4>

        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "username" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    

</main>

        <footer>

            <p class="copyright text-muted">© All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a></p>

        </footer>
       
    </body>

</html>

